{% extends "base.html" %}
{% block content %}
<br/>
<div class="container">

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
    
<div id="ram"></div>
</div>

<div class="container">
    <h4 align='center'>Running containers</h4>
    <div class="row">
        {% for c in containers %}
        <div style="font-size: 14px;" class="col-sm-4">
            <div style="height: 160px;" class="card text-white bg-primary mb-3">
                <div class="card-header">{{ c.name }} | <a href="/kill/{{ c.short_id }}"><i style="color: #fff;" class="fa fa-power-off" aria-hidden="true"></i></a></div>
                <div class="card-body">
                  <h4 style="font-size: 12px;" class="card-title">{{ c.image }}</h4>
                  <p class="card-text">
                    {% for key in c.attrs['NetworkSettings']['Ports'] %}
                    { {{ key }}: {{ c.attrs['NetworkSettings']['Ports'][key]}} }
                    {% endfor %}
                  </p>
                </div>
              </div>
        </div>
        {% endfor %}
      </div>

    <table style="font-size: 14px;" class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">ACTION</th>
                <th scope="col">SHORT_ID</th>
                <th scope="col">IMAGE</th>
                <th scope="col">IP</th>
                <th scope="col">STATUS</th>
                <th scope="col">PORTS</th>
                <th scope="col">NAMES</th>
              </tr>
            </thead>
            <tbody>
              {% for c in containers %}
              <tr>
                <td>
                  <a href="/kill/{{ c.short_id }}"><i class="fa fa-power-off" aria-hidden="true"></i></a>
                  <a target="_blank" href="http://ec2-54-245-54-226.us-west-2.compute.amazonaws.com:{{ c.attrs['NetworkSettings']['Ports']['80/tcp'][0]['HostPort'] }}">web</a>
                </td>
                <td>{{ c.short_id }}</td>
                <td>{{ c.image }}</td>
                <td>{{ c.attrs['NetworkSettings']['IPAddress'] }}</td>
                <td>{{ c.status }}</td>
                <td>{{ c.attrs['NetworkSettings']['Ports'] }}</td>
                <td>{{ c.name }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
</div>

<script>

var chart = Highcharts.chart('ram', {
chart: {
      inverted: true,
      polar: false
  },

title: {
    text: 'Running: {{ status["count"] }} app'
},

yAxis: {
        title: {
            text: 'RAM usage'
        },
        allowDecimals: true,
    },

xAxis: {
    categories: [{% for s in detail %}'{{s["name"]}}',{% endfor %}]
},

series: [{
    type: 'column',
    colorByPoint: true,
    name: 'percent of total ram',
    data: [{% for s in detail %}{{(s["memory_stats"]["max_usage"]/s["memory_stats"]["limit"])*100|round(2, 'floor')}},{% endfor %}],
    showInLegend: false
}],

rangeSelector: {
	floating: true,
     y: 100
},

});

</script>
{% endblock %}